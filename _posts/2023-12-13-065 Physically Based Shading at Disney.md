---
layout: mypost
title: 065 Physically Based Shading at Disney
categories: [图形学, PBS]
---


# 文章信息

## 标题

Physically Based Shading at Disney

## 作者

by Brent Burley, Walt Disney Animation Studios

## 本文的组织结构


- 1 Introduction
- 2 The microfacet model
- 3 Visualizing measured BRDFs
  - 3.1 The "MERL 100"
  - 3.2 BRDF Explorer
  - 3.3 Image slice
- 4 Observations from MERL materials
  - 4.1 Diffuse observations
  - 4.2 Specular D observations
  - 4.3 Specular F observations
  - 4.4 Specular G (and albedo) observations
  - 4.5 Fabric
  - 4.6 Iridescene
  - 4.7 Data anomalies
- 5 Disney "principled" BRDF
  - 5.1 Principles
  - 5.2 Parameters
  - 5.3 Diffuse model details
  - 5.4 Specular D details
  - 5.5 Specular F details
  - 5.6 Specular G details
- 6 Production experience on Wreck-It Ralph
  - 6.1 Look development
  - 6.2 Lighting
  - 6.3 Future work
- Acknowledgements
- References

- A Selected history of BRDF models used in graphics
- B GTR Microfacet Distribution
  - B.1 Microfacet distribution review
  - B.2 GTR
- Addenda
  - Anisotropic specular details
  - Sheen details
- Specular G revisited
- Revision history


# Key Points

# Abstract 

# 原文

## 1 引言 

在《长发公主》[27]中成功应用基于物理的头发着色之后，我们开始考虑将基于物理的着色模型应用于更广泛的材质。通过基于物理的头发模型，我们能够在保持艺术控制的同时实现高度的视觉丰富性。然而，将头发的光照与场景中其他仍在使用传统"特设"着色模型和点光源的部分整合起来，proved具有挑战性。对于后续的电影，我们希望增加所有材质的丰富度，同时使不同材质和环境之间的光照响应更加一致，并且还希望通过使用简化的控制来提高艺术家的工作效率。

当我们开始研究时，使用哪些模型甚至我们想要多大程度的基于物理都并不明显。我们是否应该完全保持能量守恒？我们是否应该偏好折射率等物理参数？对于漫反射，Lambert似乎是公认的标准，而镜面反射在文献中似乎得到了最多关注。一些模型如Ashikhmin-Shirley (2000) [3]旨在直观实用且物理上合理，而其他如He等人(1991) [12]提供了更全面的物理模型。还有一些模型致力于改进数据拟合[15, 14, 22, 17, 4]，但其中很少适合直接操作。我们本可以实现几个模型并让艺术家选择和组合它们，但那样我们就会回到我们试图避免的参数爆炸问题。

Ngan等人(2005) [21]对大量测量材质的研究比较了五种流行模型。总体而言，有些模型表现得比其他模型更好，但有趣的是，这些模型的性能之间存在很强的相关性——某些材质能被所有模型很好地表示，而对于其他材质，没有一个模型是合适的。增加额外的镜面反射波瓣只在少数情况下有帮助。这就引出了一个问题：在那些难以表示的材质中，什么特性没有被表示出来？

为了回答这个问题并更直观地评估BRDF模型，我们开发了一个新的BRDF查看器，可以显示和比较测量的和分析的BRDF。我们发现了查看测量BRDF数据的新的直观方式，并在测量材质中发现了一些现有模型无法很好表示的有趣特征。在这些课程笔记中，我们将分享研究测量材质的观察结果，以及我们对哪些模型适合测量数据以及它们的不足之处的见解。然后我们将介绍我们的新模型，该模型目前正在所有当前制作中使用。我们还将描述在生产中采用这个新模型的经验，并讨论我们如何在保持简单性和稳健性的同时添加适当水平的艺术控制。











## 6 《无敌破坏王》的制作经验

我们在《无敌破坏王》中部署了"原则层"着色器，并将其用于除头发（仍使用为《长发公主》开发的模型）之外的几乎所有材质。图21展示了各种材质。值得注意的是，镜面反射组件经常使用单独的法线来产生这里在地面、地毯和其他颗粒材质上看到的闪光效果。

结合我们的新材质模型，我们还引入了新的采样区域和基于图像的光源，这对于使合理的材质看起来好看至关重要；如果你制作一个合理的光亮材质并用点光源照明，你的高光将只是一个小点，但允许灯光师调整材质属性（如增加粗糙度来伪造区域光响应）会破坏整个基于物理的着色范式。好消息是灯光师真的喜欢区域光和IBL（基于图像的光照）的可控性，也欣赏材质响应的一致性。值得注意的是，新材质模型既是转向采样光源的动力，也是使其成为可能的因素，因为使用我们之前的特设着色模型，让每个反射率模块执行自己的采样光积分将会太昂贵。

基于《无敌破坏王》的成功，我们的下一部作品已经在使用或计划使用我们的新着色模型，无需修改。图21：《无敌破坏王》的制作静帧。

### 6.1 外观开发  

在所有东西上使用单一BRDF的一个好处是简化了我们的交互式材质编辑器的开发。我们的"材质设计器"渲染出包含法线、物体ID和材质层遮罩的几何缓冲区（或"g-buffer"）。使用这些通道，它可以快速执行基于图像的重光照，同时允许交互式编辑所有BRDF参数。艺术家可以实时旋转IBL，并在制作模型的完整上下文中看到所有参数和层的完整效果。统一模型的另一个好处是它促进了一个非常简单的材质库，由从材质设计器保存的一组预设组成。可以从库中选择材质并作为额外层添加到着色器中，然后用遮罩混合。因此，层可以像Photoshop层堆栈一样快速构建。

要完全判断材质，从所有角度照明它是至关重要的。作为切换到新材质模型的一部分，我们开始使用各种IBL验证所有元素，所有转台都包括元素和光照旋转。我们新着色器系统的最终结果是大大提高了外观开发的生产力，缩短了新艺术家的培训时间，并产生了更加一致的高质量结果。值得注意的是，由于在光照中不需要材质"重做"，我们大多数外观开发艺术家能够提前完成工作。这是前所未有的。

### 6.2 光照 

如前所述，新材质模型需要一种不同的光照方法。这需要一个很大的学习曲线。在不过度妥协基于物理模型的情况下添加艺术控制也是一个挑战。光照中最大的变化之一是转向使用IBL作为局部填充光。大多数IBL通过光链接用于镜头中的特定元素，许多都有距离截断。与之前很大程度上忽略材质特性的环境贴图相比，这些是一个很大的改进。区域光也是一个受欢迎的补充。最初对灯光师来说最大的挑战之一是处理真实的光强度值和衰减。我们最终开发了一个非物理衰减控制，它通过使光源虚拟地更远，同时自动调整强度来实现所需的曝光。

给定距离处的曝光，然而控制光强度和衰减仍然是灯光师面临的一个挑战。
对于光照来说，另一个挑战是镜面高光现在需要某种色调映射。光亮材质上的高光可能达到数百的亮度，简单地裁剪这些值会显得生硬，由于每个颜色通道在不同位置裁剪而引入条带，并迫使核心部分总是变成白色。我们开发了一个新的全局色调映射运算符，它在大部分显示范围内保持颜色值，并在保持颜色和对比度的同时降低顶端值。我们有一个在大多数情况下都能合理工作的默认设置，但在色彩分级过程中会根据每个镜头调整最终值。
不过最终，材质表现出可预测性，这对灯光师来说是一个巨大的好处，并为他们提供了一个物理上合理的起点。

### 6.3 未来工作

目前最大的问题之一是缺乏一个直观可控的次表面模型。这其中的一个关键方面是BRDF集成。理想情况下，BRDF和次表面模型之间应该有一个匹配，这样BRDF模型就可以用于远距离物体，实现等效的结果。此外，艺术家应该能够将平均自由路径从零增加，为物体添加次表面效果而不改变整体曝光——只有漫反射的形状应该改变（如果启用漫射，光线应该渗入阴影中）。

我们希望在布料反射建模方面走得更远。我们知道我们可以添加一个特殊的着色器，使用捕获的反射数据来渲染特别复杂的布料模型，但我们希望研究更广泛的布料材质的直接建模。不过，我们目前没有推动这一需求的项目。

我们还收到了在模型中添加虹彩效果的请求。这应该像之前讨论的那样简单，只需添加镜面颜色变化即可。
