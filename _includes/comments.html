<!-- Gitalk 评论组件 -->
{% if site.gitalk.enable %}
<div id="gitalk-container"></div>

<!-- 引入 Gitalk 相关资源 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<script>
  // 获取页面唯一标识
  var gitalkId = '{{ page.url | slugify }}';
  // 如果标识超过50个字符，则取其哈希值的后50个字符
  if (gitalkId.length > 50) {
    gitalkId = gitalkId.substr(gitalkId.length - 50);
  }
  
  // 尝试从localStorage获取Gitalk配置（仅用于本地开发）
  var clientID = localStorage.getItem('gitalk_client_id') || "{{ site.gitalk.clientID }}";
  var clientSecret = localStorage.getItem('gitalk_client_secret') || "{{ site.gitalk.clientSecret }}";
  
  // 检查是否有有效的配置
  if (clientID === 'YOUR_CLIENT_ID' || clientSecret === 'YOUR_CLIENT_SECRET') {
    document.getElementById('gitalk-container').innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">' +
      '<p>Gitalk 评论系统尚未配置。</p>' +
      '<p>请在本地开发环境中使用以下方法设置您的 GitHub OAuth 应用凭据：</p>' +
      '<pre style="text-align: left; background: #f5f5f5; padding: 10px; border-radius: 5px; margin-top: 10px;">' +
      'localStorage.setItem("gitalk_client_id", "您的Client ID");\n' +
      'localStorage.setItem("gitalk_client_secret", "您的Client Secret");</pre>' +
      '<p>请在浏览器控制台中执行上述代码。</p>' +
      '<p>注意：这些凭据仅存储在您的浏览器中，不会被提交到仓库。</p>' +
      '</div>';
  } else {
    var gitalk = new Gitalk({
      clientID: clientID,
      clientSecret: clientSecret,
      repo: "{{ site.gitalk.repo }}", // 存储评论的仓库
      owner: "{{ site.gitalk.owner }}", // 仓库所有者
      admin: {{ site.gitalk.admin | jsonify }}, // 仓库管理员，可以有多个
      id: gitalkId, // 页面唯一标识，长度必须小于50
      title: "{{ page.title }}", // 页面标题
      distractionFreeMode: false // 是否启用无干扰模式
    });
    
    gitalk.render('gitalk-container');
  }
</script>

<style>
  /* Gitalk 样式调整 */
  #gitalk-container {
    margin-top: 30px;
  }
  
  /* 暗色模式支持 */
  html.dark .gt-container .gt-btn {
    background-color: #30363d;
    border-color: #30363d;
  }
  
  html.dark .gt-container .gt-btn-preview {
    background-color: #161b22;
    color: #c9d1d9;
  }
  
  html.dark .gt-container .gt-header-textarea {
    background-color: #0d1117;
    color: #c9d1d9;
    border-color: #30363d;
  }
  
  html.dark .gt-container .gt-header-preview {
    background-color: #0d1117;
    color: #c9d1d9;
    border-color: #30363d;
  }
  
  html.dark .gt-container .gt-comment-content {
    background-color: #161b22;
    color: #c9d1d9;
    border-color: #30363d;
  }
  
  html.dark .gt-container .gt-comment-body {
    color: #c9d1d9;
  }
  
  html.dark .gt-container a {
    color: #58a6ff;
  }
  
  html.dark .gt-container .gt-svg svg {
    fill: #8b949e;
  }
  
  html.dark #gitalk-container pre {
    background-color: #161b22;
    color: #c9d1d9;
  }
</style>
{% endif %} 